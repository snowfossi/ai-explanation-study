<!-- Instructions -->
<crowd-instructions link-text="View instructions" link-type="button">
  <short-summary>
    <p>Learn to predict AI model decisions by studying explanations</p>
  </short-summary>
  
  <detailed-instructions>
    <h3>AI Explanation Study Instructions</h3>
    <p><strong>Your Goal:</strong> Learn to predict what an AI model will output by studying its explanations.</p>
    
    <h4>Important Guidelines:</h4>
    <ul>
      <li><strong>Focus on the AI's behavior</strong> - not what you think is "correct"</li>
      <li><strong>Study the explanations carefully</strong> - they show what the AI is looking at</li>
      <li><strong>During training:</strong> You'll see images + explanations + AI predictions</li>
      <li><strong>During testing:</strong> You'll see only images and must predict what the AI will say</li>
      <li><strong>Use the reference panel</strong> - you can look back at training examples during tests</li>
      <li><strong>If you do not see an explanation image</strong> - you are in the control group, please try your best to predict AI's decision</li>
    </ul>
    
    <p><strong>Payment:</strong> You must pass all screening questions and attention checks to receive payment.</p>
  </detailed-instructions>
</crowd-instructions>

<!-- Main Experiment Container -->
<div id="experiment-container">

    <!-- Consent Form (Phase 0) -->
    <div id="consent" class="phase">
        <h2>Participant Consent Form</h2>
        <div class="consent-content">
            <h3>Explainable AI: human interpretation of machine learning systems</h3>
            <h4>Invitation to Participate</h4>
            <p>You are invited to participate in a short online research study conducted by researchers at the University of Toronto. The purpose of this study is to better understand how people interpret the explanations provided by machine learning models. Your participation is entirely voluntary.</p>
            
            <h4>What Will You Be Asked to Do?</h4>
            <p>If you agree to participate:</p>
            <ul>
            <li>You will complete a short series of visual tasks.</li>
            <li>The study will take approximately 5–7 minutes.</li>
            </ul>
            
            <h4>Compensation</h4>
            <p>You will be compensated $1.25–$1.50 USD through the Amazon Mechanical Turk (AMT) platform, based on the estimated time commitment and in accordance with fair-pay guidelines (approx. $15/hour equivalent). Partial payment may be issued if you begin but do not complete the full task.</p>
            
            <h4>Risks and Benefits</h4>
            <p>There are no known risks beyond those of normal online activity. While there are no direct personal benefits, your participation will help improve understanding of how people interact with machine learning explanations, which may benefit future AI system design.</p>
            
            <h4>Voluntary Participation and Withdrawal</h4>
            <p>Participation is voluntary. You may withdraw at any time by closing your browser. If you do not complete the task, your data will not be saved. If you complete and submit the task, your data will be anonymized and cannot be withdrawn, as it will no longer be linked to you.</p>
            
            <h4>Confidentiality</h4>
            <ul>
            <li>No personally identifying information will be collected.</li>
            <li>All data will be stored securely and analyzed in aggregate.</li>
            <li>Results may be published or presented, but individual participants will not be identifiable.</li>
            </ul>
            
            <h4>Questions or Concerns</h4>
            <p>If you have any questions about the study, you may contact the student researcher at: yuhe.jiang@mail.utoronto.ca.</p>
            <p>If you have questions about your rights as a research participant, please contact the UofT Research Ethics Board at: dean.sharpe@utoronto.ca.</p>
            
            <h4>Consent Statement</h4>
            <p>By checking the box below and proceeding to the task, you confirm:</p>
            <ul>
            <li>You are 18 years of age or older;</li>
            <li>You have read and understood the information above;</li>
            <li>You voluntarily consent to participate in this study.</li>
            </ul>
            
            <div class="consent-choices">
            <label class="consent-option">
                <input type="radio" name="consent" value="agree" id="consent-agree">
                I consent to participate in this study
            </label>
            <label class="consent-option">
                <input type="radio" name="consent" value="disagree" id="consent-disagree">
                I do not consent to participate in this study
            </label>
            </div>
            
            <button onclick="handleConsent()" id="consent-submit" class="consent-btn" style="display:none;">Continue</button>
        </div>
    </div>
  
  <!-- Phase 1: Practice Session (Screening Stage 1) -->
  <div id="practice" class="phase" style="display:none;">
    <h2>Practice Session</h2>
    <p>Let's start with a practice session to make sure you understand how to use explanations to predict AI decisions.</p>
    <p>The AI focuses on certain aspects of the image to judge whether an animal, for example a cat, is present or not in the image. In this example, we use an AI trained to recognize the presence of a cat in the image. You have 4 examples of images that the AI has classified as either cat or no cat.</p>
    <p>Next to the image is the explanation, which explains how the AI decides if there is a cat in the image.  The highlighted region is where the AI looked at the most when it decided there was a cat in the image.</p>

    <!-- Practice Reservoir Panel -->
    <div id="practice-reservoir" class="reservoir">
        <h4>Practice Examples (Reference Panel)</h4>
        <div class="reservoir-content">
        <em>Practice examples will appear here during the test...</em>
        </div>
    </div>

    <div class="trial">
        <h3>Practice Examples: Cat vs Not Cat Classification</h3>
        
        <!-- Practice Example 1 -->
        <div class="practice-example" id="practice-ex1">
        <h4>Practice Example 1 of 4</h4>
        <div class="explanation-view">
            <div class="image-pair">
            <div>
                <h4>Image</h4>
                <img id="practice-example-image-1" width="300" alt="practice example 1">
            </div>
            <div>
                <h4>AI Explanation</h4>
                <img id="practice-example-explanation-1" width="300" alt="explanation 1">
            </div>
            </div>
            <p><strong>AI Prediction: <span id="practice-pred-1">Cat</span></strong></p>
            <p><em>The green box shows what the AI is focusing on to make its decision.</em></p>
        </div>
        <button onclick="nextPracticeExample(2)">Continue to Example 2</button>
        </div>
        
        <!-- Practice Example 2 -->
        <div class="practice-example" id="practice-ex2" style="display:none;">
        <h4>Practice Example 2 of 4</h4>
        <div class="explanation-view">
            <div class="image-pair">
            <div>
                <h4>Image</h4>
                <img id="practice-example-image-2" width="300" alt="practice example 2">
            </div>
            <div>
                <h4>AI Explanation</h4>
                <img id="practice-example-explanation-2" width="300" alt="explanation 2">
            </div>
            </div>
            <p><strong>AI Prediction: <span id="practice-pred-2">Not Cat</span></strong></p>
            <p><em>The green box shows what the AI is focusing on to make its decision.</em></p>
        </div>
        <button onclick="nextPracticeExample(3)">Continue to Example 3</button>
        </div>
        
        <!-- Practice Example 3 -->
        <div class="practice-example" id="practice-ex3" style="display:none;">
        <h4>Practice Example 3 of 4</h4>
        <div class="explanation-view">
            <div class="image-pair">
            <div>
                <h4>Image</h4>
                <img id="practice-example-image-3" width="300" alt="practice example 3">
            </div>
            <div>
                <h4>AI Explanation</h4>
                <img id="practice-example-explanation-3" width="300" alt="explanation 3">
            </div>
            </div>
            <p><strong>AI Prediction: <span id="practice-pred-3">Cat</span></strong></p>
            <p><em>The green box shows what the AI is focusing on to make its decision.</em></p>
        </div>
        <button onclick="nextPracticeExample(4)">Continue to Example 4</button>
        </div>
        
        <!-- Practice Example 4 -->
        <div class="practice-example" id="practice-ex4" style="display:none;">
        <h4>Practice Example 4 of 4</h4>
        <div class="explanation-view">
            <div class="image-pair">
            <div>
                <h4>Image</h4>
                <img id="practice-example-image-4" width="300" alt="practice example 4">
            </div>
            <div>
                <h4>AI Explanation</h4>
                <img id="practice-example-explanation-4" width="300" alt="explanation 4">
            </div>
            </div>
            <p><strong>AI Prediction: <span id="practice-pred-4">Not Cat</span></strong></p>
            <p><em>The green box shows what the AI is focusing on to make its decision.</em></p>
        </div>
        <button onclick="startPracticeTest()">Start Practice Test</button>
        </div>
        
        <div class="practice-test" id="practice-test-section" style="display:none;">
        <h4>Now predict what the AI will say for these new images. You can refer to the practice examples above:</h4>
        
        <div class="test-question" id="practice-q1">
            <p><strong>Question 1 of 5:</strong></p>
            <img id="practice-test-1" width="250" alt="practice test 1">
            <div class="choices">
            <label><input type="radio" name="practice1" value="cat"> Cat</label>
            <label><input type="radio" name="practice1" value="Not Cat"> Not Cat</label>
            </div>
            <button onclick="checkPracticeAnswer(1)" class="next-btn" id="practice-check-1" style="display:none;">Check Answer</button>
            <div id="practice-feedback-1" class="practice-question-feedback" style="display:none;"></div>
            <button onclick="nextPracticeQuestion(2)" class="next-btn" id="practice-next-1" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="practice-q2" style="display:none;">
            <p><strong>Question 2 of 5:</strong></p>
            <img id="practice-test-2" width="250" alt="practice test 2">
            <div class="choices">
            <label><input type="radio" name="practice2" value="cat"> Cat</label>
            <label><input type="radio" name="practice2" value="Not Cat"> Not Cat</label>
            </div>
            <button onclick="checkPracticeAnswer(2)" class="next-btn" id="practice-check-2" style="display:none;">Check Answer</button>
            <div id="practice-feedback-2" class="practice-question-feedback" style="display:none;"></div>
            <button onclick="nextPracticeQuestion(3)" class="next-btn" id="practice-next-2" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="practice-q3" style="display:none;">
            <p><strong>Question 3 of 5:</strong></p>
            <img id="practice-test-3" width="250" alt="practice test 3">
            <div class="choices">
            <label><input type="radio" name="practice3" value="cat"> Cat</label>
            <label><input type="radio" name="practice3" value="Not Cat"> Not Cat</label>
            </div>
            <button onclick="checkPracticeAnswer(3)" class="next-btn" id="practice-check-3" style="display:none;">Check Answer</button>
            <div id="practice-feedback-3" class="practice-question-feedback" style="display:none;"></div>
            <button onclick="nextPracticeQuestion(4)" class="next-btn" id="practice-next-3" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="practice-q4" style="display:none;">
            <p><strong>Question 4 of 5:</strong></p>
            <img id="practice-test-4" width="250" alt="practice test 4">
            <div class="choices">
            <label><input type="radio" name="practice4" value="cat"> Cat</label>
            <label><input type="radio" name="practice4" value="Not Cat"> Not Cat</label>
            </div>
            <button onclick="checkPracticeAnswer(4)" class="next-btn" id="practice-check-4" style="display:none;">Check Answer</button>
            <div id="practice-feedback-4" class="practice-question-feedback" style="display:none;"></div>
            <button onclick="nextPracticeQuestion(5)" class="next-btn" id="practice-next-4" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="practice-q5" style="display:none;">
            <p><strong>Question 5 of 5:</strong></p>
            <img id="practice-test-5" width="250" alt="practice test 5">
            <div class="choices">
            <label><input type="radio" name="practice5" value="cat"> Cat</label>
            <label><input type="radio" name="practice5" value="Not Cat"> Not Cat</label>
            </div>
            <button onclick="checkPracticeAnswer(5)" class="next-btn" id="practice-check-5" style="display:none;">Check Answer</button>
            <div id="practice-feedback-5" class="practice-question-feedback" style="display:none;"></div>
            <button onclick="finalizePracticeResults()" class="next-btn" id="practice-next-5" style="display:none;">Continue to Quiz</button>
        </div>
        </div>
        
        <div id="practice-results" style="display:none;">
            <div id="practice-feedback"></div>
            <button onclick="nextPhase('quiz')" id="proceed-to-quiz" style="display:none;">Continue to Quiz</button>
        </div>
        </div>
    </div>
    </div>
  
  <!-- Phase 2: Comprehension Quiz (Screening Stage 2) -->
  <div id="quiz" class="phase" style="display:none;">
    <h2>Comprehension Check</h2>
    <p>Please answer these questions to make sure you understood the instructions:</p>
    
    <div class="quiz-question">
      <p><strong>Question 1:</strong> In this study, what should you focus on predicting?</p>
      <div class="choices">
        <label><input type="radio" name="quiz1" value="correct"> What you think is the correct answer</label>
        <label><input type="radio" name="quiz1" value="ai"> What the AI model will predict</label>
        <label><input type="radio" name="quiz1" value="random"> Random guesses</label>
      </div>
    </div>
    
    <div class="quiz-question">
      <p><strong>Question 2:</strong> During the testing phase, what will you see?</p>
      <div class="choices">
        <label><input type="radio" name="quiz2" value="both"> Images with explanations</label>
        <label><input type="radio" name="quiz2" value="images"> Only images, no explanations</label>
        <label><input type="radio" name="quiz2" value="explanations"> Only explanations, no images</label>
      </div>
    </div>
    
    <div class="quiz-question">
      <p><strong>Question 3:</strong> What do the explanation show you?</p>
      <div class="choices">
        <label><input type="radio" name="quiz3" value="correct"> What parts of the image are actually important</label>
        <label><input type="radio" name="quiz3" value="ai"> What parts of the image the AI is focusing on</label>
        <label><input type="radio" name="quiz3" value="random"> Random colored regions</label>
      </div>
    </div>
    
    <button onclick="checkQuizAnswers()" id="submit-quiz">Submit Quiz</button>
    <div id="quiz-feedback" style="display:none;"></div>
    <button onclick="nextPhase('training1')" id="start-main-experiment" style="display:none;">Start Main Experiment</button>
  </div>
  
  <!-- Training Session 1 -->
  <div id="training1" class="phase" style="display:none;">
    <h2>Training Session 1</h2>
    <p>Study these examples carefully. Pay attention to the AI's predictions for each image.</p>
    
    <!-- Reservoir Panel -->
    <div id="reservoir1" class="reservoir">
      <h4>Training Examples (Reference Panel)</h4>
      <div class="reservoir-content">
        <em>Training examples will appear here during testing</em>
      </div>
    </div>
    
    <div id="training1-examples">
      <div class="training-trial" id="train1-ex1">
        <h3>Training Example 1 of 5</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train1-img-1" width="300" alt="training 1-1">
        </div>
        <p><strong>AI Prediction: <span id="train1-pred-1">Class A</span></strong></p>
        <button onclick="nextTrainingExample(1, 2)">Continue</button>
      </div>
      
      <div class="training-trial" id="train1-ex2" style="display:none;">
        <h3>Training Example 2 of 5</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train1-img-2" width="300" alt="training 1-2">
        </div>
        <p><strong>AI Prediction: <span id="train1-pred-2">Class B</span></strong></p>
        <button onclick="nextTrainingExample(1, 3)">Continue</button>
      </div>
      
      <div class="training-trial" id="train1-ex3" style="display:none;">
        <h3>Training Example 3 of 5</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train1-img-3" width="300" alt="training 1-3">
        </div>
        <p><strong>AI Prediction: <span id="train1-pred-3">Class A</span></strong></p>
        <button onclick="nextTrainingExample(1, 4)">Continue</button>
      </div>
      
      <div class="training-trial" id="train1-ex4" style="display:none;">
        <h3>Training Example 4 of 5</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train1-img-4" width="300" alt="training 1-4">
        </div>
        <p><strong>AI Prediction: <span id="train1-pred-4">Class B</span></strong></p>
        <button onclick="nextTrainingExample(1, 5)">Continue</button>
      </div>
      
      <div class="training-trial" id="train1-ex5" style="display:none;">
        <h3>Training Example 5 of 5</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train1-img-5" width="300" alt="training 1-5">
        </div>
        <p><strong>AI Prediction: <span id="train1-pred-5">Class A</span></strong></p>
        <button onclick="startTest(1)">Start Test</button>
      </div>
    </div>
    
    <!-- Test Phase for Session 1 -->
    <div id="test1" style="display:none;">
      <h2>Test Session 1</h2>
      <p>Now predict what the AI will say for these images. You can refer to the training examples above.</p>
      
      <div class="test-questions">
        <div class="test-question" id="test1-q1">
          <p><strong>Test Question 1 of 7:</strong></p>
          <img id="test1-img-1" width="300" alt="test 1-1">
          <div class="choices">
            <label><input type="radio" name="test1_q1" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q1" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 2)" class="next-btn" id="test1-next-1" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test1-q2" style="display:none;">
          <p><strong>Test Question 2 of 7:</strong></p>
          <img id="test1-img-2" width="300" alt="test 1-2">
          <div class="choices">
            <label><input type="radio" name="test1_q2" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q2" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 3)" class="next-btn" id="test1-next-2" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test1-q3" style="display:none;">
          <p><strong>Test Question 3 of 7:</strong></p>
          <img id="test1-img-3" width="300" alt="test 1-3">
          <div class="choices">
            <label><input type="radio" name="test1_q3" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q3" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 4)" class="next-btn" id="test1-next-3" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test1-q4" style="display:none;">
          <p><strong>Test Question 4 of 7:</strong></p>
          <img id="test1-img-4" width="300" alt="test 1-4">
          <div class="choices">
            <label><input type="radio" name="test1_q4" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q4" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 5)" class="next-btn" id="test1-next-4" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test1-q5" style="display:none;">
          <p><strong>Test Question 5 of 7:</strong></p>
          <img id="test1-img-5" width="300" alt="test 1-5">
          <div class="choices">
            <label><input type="radio" name="test1_q5" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q5" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 6)" class="next-btn" id="test1-next-5" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test1-q6" style="display:none;">
          <p><strong>Test Question 6 of 7:</strong></p>
          <img id="test1-img-6" width="300" alt="test 1-6">
          <div class="choices">
            <label><input type="radio" name="test1_q6" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q6" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(1, 7)" class="next-btn" id="test1-next-6" style="display:none;">Next</button>
        </div>
        
        <!-- CATCH TRIAL (Question 7) - Uses training image 3 -->
        <div class="test-question" id="test1-q7" style="display:none;">
          <p><strong>Test Question 7 of 7:</strong></p>
          <img id="test1-img-7" width="300" alt="catch trial">
          <div class="choices">
            <label><input type="radio" name="test1_q7" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test1_q7" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextPhase('training2')" class="next-btn" id="test1-next-7" style="display:none;">Continue to Session 2</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Training Session 2 -->
  <div id="training2" class="phase" style="display:none;">
    <h2>Training Session 2</h2>
    <p>Study these examples carefully. Pay attention to the AI's predictions for each image.</p>
    
    <div id="reservoir2" class="reservoir">
      <h4>Training Examples (Reference Panel)</h4>
      <div class="reservoir-content">
        <em>Training examples will appear here during testing</em>
      </div>
    </div>
    
    <div id="training2-examples">
      <div class="training-trial" id="train2-ex1">
        <h3>Training Example 1 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-1" width="300" alt="training 2-1">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-1">Class B</span></strong></p>
        <button onclick="nextTrainingExample(2, 2)">Continue</button>
      </div>
      
      <div class="training-trial" id="train2-ex2" style="display:none;">
        <h3>Training Example 2 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-2" width="300" alt="training 2-2">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-2">Class A</span></strong></p>
        <button onclick="nextTrainingExample(2, 3)">Continue</button>
      </div>
      
      <div class="training-trial" id="train2-ex3" style="display:none;">
        <h3>Training Example 3 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-3" width="300" alt="training 2-3">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-3">Class B</span></strong></p>
        <button onclick="nextTrainingExample(2, 4)">Continue</button>
      </div>
      
      <div class="training-trial" id="train2-ex4" style="display:none;">
        <h3>Training Example 4 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-4" width="300" alt="training 2-4">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-4">Class A</span></strong></p>
        <button onclick="nextTrainingExample(2, 5)">Continue</button>
      </div>
      
      <div class="training-trial" id="train2-ex5" style="display:none;">
        <h3>Training Example 5 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-5" width="300" alt="training 2-5">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-5">Class B</span></strong></p>
        <button onclick="nextTrainingExample(2, 6)">Continue</button>
      </div>

      <div class="training-trial" id="train2-ex6" style="display:none;">
        <h3>Training Example 6 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-6" width="300" alt="training 2-6">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-6">Class A</span></strong></p>
        <button onclick="nextTrainingExample(2, 7)">Continue</button>
      </div>

      <div class="training-trial" id="train2-ex7" style="display:none;">
        <h3>Training Example 7 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-7" width="300" alt="training 2-7">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-7">Class B</span></strong></p>
        <button onclick="nextTrainingExample(2, 8)">Continue</button>
      </div>

      <div class="training-trial" id="train2-ex8" style="display:none;">
        <h3>Training Example 8 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-8" width="300" alt="training 2-8">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-8">Class A</span></strong></p>
        <button onclick="nextTrainingExample(2, 9)">Continue</button>
      </div>

      <div class="training-trial" id="train2-ex9" style="display:none;">
        <h3>Training Example 9 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-9" width="300" alt="training 2-9">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-9">Class B</span></strong></p>
        <button onclick="nextTrainingExample(2, 10)">Continue</button>
      </div>

      <div class="training-trial" id="train2-ex10" style="display:none;">
        <h3>Training Example 10 of 10</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train2-img-10" width="300" alt="training 2-10">
        </div>
        <p><strong>AI Prediction: <span id="train2-pred-10">Class A</span></strong></p>
        <button onclick="startTest(2)">Start Test</button>
      </div>
    </div>
    
    <!-- Test Phase for Session 2 -->
    <div id="test2" style="display:none;">
      <h2>Test Session 2</h2>
      <p>Now predict what the AI will say for these images. You can refer to the training examples above.</p>
      
      <div class="test-questions">
        <div class="test-question" id="test2-q1">
          <p><strong>Test Question 1 of 7:</strong></p>
          <img id="test2-img-1" width="300" alt="test 2-1">
          <div class="choices">
            <label><input type="radio" name="test2_q1" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q1" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 2)" class="next-btn" id="test2-next-1" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test2-q2" style="display:none;">
          <p><strong>Test Question 2 of 7:</strong></p>
          <img id="test2-img-2" width="300" alt="test 2-2">
          <div class="choices">
            <label><input type="radio" name="test2_q2" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q2" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 3)" class="next-btn" id="test2-next-2" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test2-q3" style="display:none;">
          <p><strong>Test Question 3 of 7:</strong></p>
          <img id="test2-img-3" width="300" alt="test 2-3">
          <div class="choices">
            <label><input type="radio" name="test2_q3" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q3" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 4)" class="next-btn" id="test2-next-3" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test2-q4" style="display:none;">
          <p><strong>Test Question 4 of 7:</strong></p>
          <img id="test2-img-4" width="300" alt="test 2-4">
          <div class="choices">
            <label><input type="radio" name="test2_q4" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q4" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 5)" class="next-btn" id="test2-next-4" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test2-q5" style="display:none;">
          <p><strong>Test Question 5 of 7:</strong></p>
          <img id="test2-img-5" width="300" alt="test 2-5">
          <div class="choices">
            <label><input type="radio" name="test2_q5" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q5" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 6)" class="next-btn" id="test2-next-5" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test2-q6" style="display:none;">
          <p><strong>Test Question 6 of 7:</strong></p>
          <img id="test2-img-6" width="300" alt="test 2-6">
          <div class="choices">
            <label><input type="radio" name="test2_q6" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q6" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(2, 7)" class="next-btn" id="test2-next-6" style="display:none;">Next</button>
        </div>
        
        <!-- CATCH TRIAL (Question 7) -->
        <div class="test-question" id="test2-q7" style="display:none;">
          <p><strong>Test Question 7 of 7:</strong></p>
          <img id="test2-img-7" width="300" alt="catch trial">
          <div class="choices">
            <label><input type="radio" name="test2_q7" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test2_q7" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextPhase('training3')" class="next-btn" id="test2-next-7" style="display:none;">Continue to Session 3</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Training Session 3 -->
  <div id="training3" class="phase" style="display:none;">
    <h2>Training Session 3</h2>
    <p>Study these examples carefully. Pay attention to the AI's predictions for each image.</p>
    
    <div id="reservoir3" class="reservoir">
      <h4>Training Examples (Reference Panel)</h4>
      <div class="reservoir-content">
        <em>Training examples will appear here during testing</em>
      </div>
    </div>
    
    <div id="training3-examples">
      <div class="training-trial" id="train3-ex1">
        <h3>Training Example 1 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-1" width="300" alt="training 3-1">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-1">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 2)">Continue</button>
      </div>
      
      <div class="training-trial" id="train3-ex2" style="display:none;">
        <h3>Training Example 2 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-2" width="300" alt="training 3-2">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-2">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 3)">Continue</button>
      </div>
      
      <div class="training-trial" id="train3-ex3" style="display:none;">
        <h3>Training Example 3 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-3" width="300" alt="training 3-3">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-3">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 4)">Continue</button>
      </div>
      
      <div class="training-trial" id="train3-ex4" style="display:none;">
        <h3>Training Example 4 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-4" width="300" alt="training 3-4">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-4">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 5)">Continue</button>
      </div>
      
      <div class="training-trial" id="train3-ex5" style="display:none;">
        <h3>Training Example 5 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-5" width="300" alt="training 3-5">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-5">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 6)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex6" style="display:none;">
        <h3>Training Example 6 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-6" width="300" alt="training 3-6">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-6">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 7)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex7" style="display:none;">
        <h3>Training Example 7 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-7" width="300" alt="training 3-7">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-7">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 8)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex8" style="display:none;">
        <h3>Training Example 8 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-8" width="300" alt="training 3-8">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-8">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 9)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex9" style="display:none;">
        <h3>Training Example 9 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-9" width="300" alt="training 3-9">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-9">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 10)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex10" style="display:none;">
        <h3>Training Example 10 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-10" width="300" alt="training 3-10">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-10">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 11)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex11" style="display:none;">
        <h3>Training Example 11 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-11" width="300" alt="training 3-11">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-11">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 12)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex12" style="display:none;">
        <h3>Training Example 12 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-12" width="300" alt="training 3-12">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-12">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 13)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex13" style="display:none;">
        <h3>Training Example 13 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-13" width="300" alt="training 3-13">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-13">Class A</span></strong></p>
        <button onclick="nextTrainingExample(3, 14)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex14" style="display:none;">
        <h3>Training Example 14 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-14" width="300" alt="training 3-14">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-14">Class B</span></strong></p>
        <button onclick="nextTrainingExample(3, 15)">Continue</button>
      </div>

      <div class="training-trial" id="train3-ex15" style="display:none;">
        <h3>Training Example 15 of 15</h3>
        <div class="image-center">
          <h4>Image</h4>
          <img id="train3-img-15" width="300" alt="training 3-15">
        </div>
        <p><strong>AI Prediction: <span id="train3-pred-15">Class A</span></strong></p>
        <button onclick="startTest(3)">Start Test</button>
      </div>
    </div>
    
    <!-- Test Phase for Session 3 -->
    <div id="test3" style="display:none;">
      <h2>Test Session 3</h2>
      <p>Now predict what the AI will say for these images. You can refer to the training examples above.</p>
      
      <div class="test-questions">
        <div class="test-question" id="test3-q1">
          <p><strong>Test Question 1 of 7:</strong></p>
          <img id="test3-img-1" width="300" alt="test 3-1">
          <div class="choices">
            <label><input type="radio" name="test3_q1" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q1" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 2)" class="next-btn" id="test3-next-1" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test3-q2" style="display:none;">
          <p><strong>Test Question 2 of 7:</strong></p>
          <img id="test3-img-2" width="300" alt="test 3-2">
          <div class="choices">
            <label><input type="radio" name="test3_q2" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q2" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 3)" class="next-btn" id="test3-next-2" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test3-q3" style="display:none;">
          <p><strong>Test Question 3 of 7:</strong></p>
          <img id="test3-img-3" width="300" alt="test 3-3">
          <div class="choices">
            <label><input type="radio" name="test3_q3" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q3" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 4)" class="next-btn" id="test3-next-3" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test3-q4" style="display:none;">
          <p><strong>Test Question 4 of 7:</strong></p>
          <img id="test3-img-4" width="300" alt="test 3-4">
          <div class="choices">
            <label><input type="radio" name="test3_q4" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q4" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 5)" class="next-btn" id="test3-next-4" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test3-q5" style="display:none;">
          <p><strong>Test Question 5 of 7:</strong></p>
          <img id="test3-img-5" width="300" alt="test 3-5">
          <div class="choices">
            <label><input type="radio" name="test3_q5" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q5" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 6)" class="next-btn" id="test3-next-5" style="display:none;">Next</button>
        </div>
        
        <div class="test-question" id="test3-q6" style="display:none;">
          <p><strong>Test Question 6 of 7:</strong></p>
          <img id="test3-img-6" width="300" alt="test 3-6">
          <div class="choices">
            <label><input type="radio" name="test3_q6" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q6" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="nextTestQuestion(3, 7)" class="next-btn" id="test3-next-6" style="display:none;">Next</button>
        </div>
        
        <!-- CATCH TRIAL (Question 7) -->
        <div class="test-question" id="test3-q7" style="display:none;">
          <p><strong>Test Question 7 of 7:</strong></p>
          <img id="test3-img-7" width="300" alt="catch trial">
          <div class="choices">
            <label><input type="radio" name="test3_q7" value="kitfix"> Model predicts Kit Fox</label>
            <label><input type="radio" name="test3_q7" value="redfox"> Model predicts Red Fox</label>
          </div>
          <button onclick="completeStudy()" class="next-btn" id="test3-next-7" style="display:none;">Complete Study</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Completion -->
  <div id="completion" class="phase" style="display:none;">
    <h2>Study Complete!</h2>
    <p>Thank you for your careful participation. Your responses have been recorded.</p>
    <p><strong>Important:</strong> Please do not discuss this study with others, as it may affect future research.</p>
  </div>
  
  <!-- Termination for failed screening -->
  <div id="termination" class="phase" style="display:none;">
    <h2>Study Ended</h2>
    <p>Thank you for your time. Unfortunately, you did not meet the requirements to continue with this study.</p>
    <p>This is not a reflection of your abilities - this study requires very specific responses for research validity.</p>
  </div>
</div>

<form style="display:none;">
  <input type="hidden" name="prolific_id" id="prolific-id-hidden">
  <input type="hidden" name="all_responses" id="all-responses">
  <input type="hidden" name="completion_time" id="completion-time">
  <input type="hidden" name="participant_id" id="participant-id">
</form>

<style>
.phase { margin: 20px 0; }
.image-pair { display: flex; gap: 30px; justify-content: center; margin: 20px 0; }
.image-pair div { text-align: center; }
.image-center { text-align: center; margin: 20px 0; }
.choices { margin: 15px 0; }
.choices label { display: block; margin: 8px 0; cursor: pointer; }
.choices input { margin-right: 10px; }
.next-btn, button { padding: 10px 20px; margin: 10px 5px; background: #007cba; color: white; border: none; cursor: pointer; }
.next-btn:hover, button:hover { background: #005a87; }
.reservoir { border: 2px solid #ccc; padding: 15px; margin: 20px 0; background: #f9f9f9; }
.reservoir-content img {
  border: 1px solid #ccc;
  background-color: #f9f9f9;
  object-fit: contain;
}
.reservoir-content {
  max-height: 400px;
  overflow-y: auto;
}
.quiz-question, .test-question, .training-trial { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
.error { color: red; font-weight: bold; }
.success { color: green; font-weight: bold; }
img {
  border: 1px solid #ddd;
  background-color: #f9f9f9;
}
.consent-content {
  max-width: 800px;
  margin: 0 auto;
  text-align: left;
  line-height: 1.5;
}

.consent-content h3 {
  color: #007cba;
  margin-top: 0;
}

.consent-content h4 {
  color: #333;
  margin-top: 25px;
  margin-bottom: 10px;
}

.consent-content ul {
  margin: 10px 0;
  padding-left: 25px;
}

.consent-content li {
  margin: 5px 0;
}

.consent-choices {
  margin: 20px 0;
  padding: 15px;
  border: 2px solid #ddd;
  background-color: #f9f9f9;
}

.consent-option {
  display: block;
  margin: 10px 0;
  font-weight: bold;
  cursor: pointer;
}

.consent-option input {
  margin-right: 10px;
}

.consent-btn {
  padding: 12px 30px;
  margin: 20px 5px;
  background: #007cba;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 16px;
}

.consent-btn:hover {
  background: #005a87;
}

.practice-question-feedback {
  margin: 10px 0;
  padding: 10px;
  border-radius: 5px;
}

.practice-question-feedback.correct {
  background-color: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}

.practice-question-feedback.incorrect {
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  color: #721c24;
}
</style>

<script>

// =======================
// CONSENT HANDLERS
// =======================

function handleConsent() {
  const consentChoice = document.querySelector('input[name="consent"]:checked');
  
  if (!consentChoice) {
    alert('Please select whether you consent to participate.');
    return;
  }
  
  if (consentChoice.value === 'agree') {
    // Record consent and proceed to practice
    responses.consent = 'agreed';
    responses.timestamps.consent = new Date().toISOString();
    nextPhase('practice');
  } else {
    // Handle non-consent - end study
    responses.consent = 'declined';
    responses.timestamps.consent = new Date().toISOString();
    endStudyNoConsent();
  }
}

function endStudyNoConsent() {
  // Hide all phases and show a termination message
  document.querySelectorAll('.phase').forEach(p => p.style.display = 'none');
  
  // Create and show no-consent termination message
  const noConsentDiv = document.createElement('div');
  noConsentDiv.id = 'no-consent-termination';
  noConsentDiv.className = 'phase';
  noConsentDiv.innerHTML = `
    <h2>Thank You</h2>
    <p>Thank you for your time. Since you have not provided consent to participate, the study will now end.</p>
    <p>You may close this window.</p>
  `;
  
  document.getElementById('experiment-container').appendChild(noConsentDiv);
  noConsentDiv.style.display = 'block';
}


// =======================
// CENTRALIZED IMAGE URLS
// =======================

// Replace these with your actual image URLs
const IMAGE_URLS = {
  // Practice images (6 total: 1 example + 5 test)
  practice: {
    example_images: [
        'https://i.imgur.com/aJvtLRd.jpeg',
        'https://i.imgur.com/cm4gtXy.jpeg',
        'https://i.imgur.com/UQlBkkR.jpeg',
        'https://i.imgur.com/dhKUydU.jpeg',
    ],
    example_explanations: [
        'https://i.imgur.com/VFpXNNZ.png',
        'https://i.imgur.com/Ragzway.png',
        'https://i.imgur.com/TTzUyXm.png',
        'https://i.imgur.com/qhfomvD.png',
    ],
    example_predictions: ['Cat', 'Not Cat', 'Not Cat', 'Cat'], // Predictions for each example
    test_images: [
        'https://i.imgur.com/VSOFRbe.jpeg',
        'https://i.imgur.com/N74tTqM.jpeg',
        'https://i.imgur.com/JMBKnJb.jpeg',
        'https://i.imgur.com/NMieZro.jpeg',
        'https://i.imgur.com/RYcKgMQ.jpeg'
    ]
  },
  
  // Training session images (30 total: 5 + 10 + 15)
  training: {
    images: [
      // Session 1 (indices 0-4)
      
    'https://i.imgur.com/Me7ie8h.jpeg',
    'https://i.imgur.com/t9aLaMI.jpeg',
    'https://i.imgur.com/b1tELIZ.jpeg',
    'https://i.imgur.com/uzH9NJ9.jpeg',
    'https://i.imgur.com/VCEFp4C.jpeg',

      // Session 2 (indices 5-14)
    'https://i.imgur.com/fshRLiL.jpeg',
    'https://i.imgur.com/OcqnvM7.jpeg',
    'https://i.imgur.com/anwAtU7.jpeg',
    'https://i.imgur.com/S93w1hp.jpeg',
    'https://i.imgur.com/vlV0vfl.jpeg',
    'https://i.imgur.com/4yEgGTd.jpeg',
    'https://i.imgur.com/CwPRbuE.jpeg',
    'https://i.imgur.com/V8gF6z7.jpeg',
    'https://i.imgur.com/QGvdF8o.jpeg',
    'https://i.imgur.com/OM55iAH.jpeg',


      // Session 3 (indices 15-29)
      'https://i.imgur.com/7PHwVRS.jpeg',
      'https://i.imgur.com/hL1pstf.jpeg',
      'https://i.imgur.com/iLVVzOn.jpeg',
      'https://i.imgur.com/IlDj7ld.jpeg',
      'https://i.imgur.com/ZqKAYNo.jpeg',
      'https://i.imgur.com/vziG2gb.jpeg',
      'https://i.imgur.com/pXSinsr.jpeg',
      'https://i.imgur.com/lLQjMcP.jpeg',
      'https://i.imgur.com/oq9J3OH.jpeg',
      'https://i.imgur.com/84h1Nyu.jpeg',
      'https://i.imgur.com/86RjG97.jpeg',
      'https://i.imgur.com/Ur2Cywn.jpeg',
      'https://i.imgur.com/I8EaemU.jpeg',
      'https://i.imgur.com/zaAIcvz.jpeg',
      'https://i.imgur.com/r7JOmlN.jpeg',


    ],

    predictions: [
      // Session 1 predictions
      'Class Kit Fox', 'Class Kit Fox', 'Class Red Fox', 'Class Red Fox', 'Class Kit Fox',
      // Session 2 predictions
      'Class Kit Fox', 'Class Kit Fox', 'Class Red Fox', 'Class Kit Fox', 'Class Kit Fox',
      'Class Kit Fox', 'Class Red Fox', 'Class Red Fox', 'Class Kit Fox', 'Class Red Fox',
      // Session 3 predictions
      'Class Red Fox', 'Class Kit Fox', 'Class Red Fox', 'Class Red Fox', 'Class Kit Fox',
      'Class Red Fox', 'Class Kit Fox', 'Class Kit Fox', 'Class Kit Fox', 'Class Kit Fox',
      'Class Red Fox', 'Class Kit Fox', 'Class Kit Fox', 'Class Red Fox', 'Class Kit Fox'
    ]
  },
  
  // Test images (21 total: 7 per session, including catch trials)
  test: {
    images: [
      // Session 1 tests (indices 0-6)
    'https://i.imgur.com/cgtZl0k.jpeg',
    'https://i.imgur.com/AR2I60v.jpeg',
    'https://i.imgur.com/T9mKmS6.jpeg',
    'https://i.imgur.com/LZyzLaI.jpeg',
    'https://i.imgur.com/riVfNUY.jpeg',
    'https://i.imgur.com/IgMRVH0.jpeg',
    'https://i.imgur.com/t9aLaMI.jpeg', // Catch trial - same as training session 1, example 2
      
      // Session 2 tests (indices 7-13)
      'https://i.imgur.com/LZyzLaI.jpeg',
      'https://i.imgur.com/cgtZl0k.jpeg',
      'https://i.imgur.com/riVfNUY.jpeg',
      'https://i.imgur.com/AR2I60v.jpeg',
      'https://i.imgur.com/T9mKmS6.jpeg',
      'https://i.imgur.com/IgMRVH0.jpeg',
      'https://i.imgur.com/OcqnvM7.jpeg', // Catch trial - same as training session 2, example 2
      
      // Session 3 tests (indices 14-20)
      'https://i.imgur.com/cgtZl0k.jpeg',
      'https://i.imgur.com/LZyzLaI.jpeg',
      'https://i.imgur.com/IgMRVH0.jpeg',
      'https://i.imgur.com/AR2I60v.jpeg',
      'https://i.imgur.com/riVfNUY.jpeg',
      'https://i.imgur.com/T9mKmS6.jpeg',
      'https://i.imgur.com/7PHwVRS.jpeg', // Catch trial - same as training session 3, example 1
    ]
  }
};

// =======================
// EXPERIMENT DATA & STATE
// =======================

let responses = {
  practice: {},
  quiz: {},
  training: {},
  tests: {},
  catchTrials: {},
  timestamps: {}
};

// Auto-capture Prolific ID
function getProlificId() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('PROLIFIC_PID') || 'direct_access';
}

let currentSession = 1;
let practiceScore = 0;
let startTime = new Date();

// =======================
// IMAGE LOADING FUNCTIONS
// =======================

function loadAllImages() {
    // Load practice images - 4 examples + 5 test images
    for (let i = 1; i <= 4; i++) {
    document.getElementById(`practice-example-image-${i}`).src = IMAGE_URLS.practice.example_images[i-1];
    document.getElementById(`practice-example-explanation-${i}`).src = IMAGE_URLS.practice.example_explanations[i-1];
    document.getElementById(`practice-pred-${i}`).textContent = IMAGE_URLS.practice.example_predictions[i-1];
    }

    for (let i = 1; i <= 5; i++) {
    document.getElementById(`practice-test-${i}`).src = IMAGE_URLS.practice.test_images[i-1];
    }
  
  // Load training images for all sessions
  for (let session = 1; session <= 3; session++) {
    let numExamples;
    if (session === 1) numExamples = 5;
    else if (session === 2) numExamples = 10;
    else numExamples = 15;
    
    for (let ex = 1; ex <= numExamples; ex++) {
      const index = (session === 1 ? 0 : session === 2 ? 5 : 15) + (ex - 1);
      document.getElementById(`train${session}-img-${ex}`).src = IMAGE_URLS.training.images[index];
      document.getElementById(`train${session}-pred-${ex}`).textContent = IMAGE_URLS.training.predictions[index];
    }
  }
  
  // Load test images for all sessions
  for (let session = 1; session <= 3; session++) {
    for (let q = 1; q <= 7; q++) {
      const index = (session - 1) * 7 + (q - 1);
      document.getElementById(`test${session}-img-${q}`).src = IMAGE_URLS.test.images[index];
    }
  }
  
  console.log('All images loaded from centralized URLs');
}

// =======================
// PRACTICE SESSION HANDLERS
// =======================

function populatePracticeReservoir() {
  const reservoir = document.getElementById('practice-reservoir').querySelector('.reservoir-content');
  
  // Clear existing content
  reservoir.innerHTML = '';
  
  // Add all 4 practice examples
  for (let exampleNum = 0; exampleNum < 4; exampleNum++) {
    const prediction = IMAGE_URLS.practice.example_predictions[exampleNum];
    const imageUrl = IMAGE_URLS.practice.example_images[exampleNum];
    const explanationUrl = IMAGE_URLS.practice.example_explanations[exampleNum];
    
    const reservoirItem = document.createElement('div');
    reservoirItem.style.borderBottom = '1px solid #ddd';
    reservoirItem.style.padding = '10px 0';
    reservoirItem.innerHTML = `
      <div style="margin-bottom: 10px;">
        <div style="font-size: 14px; font-weight: bold;">Practice Example ${exampleNum + 1}</div>
        <div style="display: flex; gap: 20px; margin: 10px 0; align-items: flex-start;">
          <div style="text-align: center;">
            <div style="font-size: 12px; margin-bottom: 5px;">Image</div>
            <img src="${imageUrl}" style="width: 120px; height: 90px; object-fit: contain; border: 1px solid #ccc;">
          </div>
          <div style="text-align: center;">
            <div style="font-size: 12px; margin-bottom: 5px;">AI Explanation</div>
            <img src="${explanationUrl}" style="width: 120px; height: 90px; object-fit: contain; border: 1px solid #ccc;">
          </div>
          <div style="align-self: center; min-width: 100px;">
            <div style="font-size: 13px; font-weight: bold;">AI Prediction:</div>
            <div style="font-size: 13px;">${prediction}</div>
          </div>
        </div>
      </div>
    `;
    
    reservoir.appendChild(reservoirItem);
  }
}

function nextPracticeExample(exampleNum) {
  // Hide current example
  document.getElementById(`practice-ex${exampleNum-1}`).style.display = 'none';
  // Show next example
  if (exampleNum <= 4) {
    document.getElementById(`practice-ex${exampleNum}`).style.display = 'block';
  }
}

function startPracticeTest() {
  // Hide all examples
  document.querySelectorAll('.practice-example').forEach(ex => ex.style.display = 'none');
  
  // Populate the practice reservoir with all examples
  populatePracticeReservoir();
  
  // Show test section
  document.getElementById('practice-test-section').style.display = 'block';
}

function nextPracticeQuestion(questionNum) {
  document.getElementById(`practice-q${questionNum-1}`).style.display = 'none';
  if (questionNum <= 5) {
    document.getElementById(`practice-q${questionNum}`).style.display = 'block';
  }
}

// Define correct answers for practice questions
const PRACTICE_CORRECT_ANSWERS = ['cat', 'cat', 'Not Cat', 'Not Cat', 'Not Cat'];

function checkPracticeAnswer(questionNum) {
  const selectedAnswer = document.querySelector(`input[name="practice${questionNum}"]:checked`);
  
  if (!selectedAnswer) {
    alert('Please select an answer before checking.');
    return;
  }
  
  const userAnswer = selectedAnswer.value;
  const correctAnswer = PRACTICE_CORRECT_ANSWERS[questionNum - 1];
  const isCorrect = userAnswer === correctAnswer;
  
  const feedbackDiv = document.getElementById(`practice-feedback-${questionNum}`);
  const checkButton = document.getElementById(`practice-check-${questionNum}`);
  const nextButton = document.getElementById(`practice-next-${questionNum}`);
  
  // Show feedback
  feedbackDiv.style.display = 'block';
  feedbackDiv.className = isCorrect ? 'practice-question-feedback correct' : 'practice-question-feedback incorrect';
  
  if (isCorrect) {
    feedbackDiv.innerHTML = '<strong>Correct!</strong> You successfully predicted what the AI would say.';
    checkButton.style.display = 'none';
    nextButton.style.display = 'block';
    
    // Disable radio buttons for this question
    document.querySelectorAll(`input[name="practice${questionNum}"]`).forEach(input => {
      input.disabled = true;
    });
  } else {
    feedbackDiv.innerHTML = `<strong>Incorrect.</strong> Please observe the examples in the reservoir and try again (hint: look at the cat tails).\n Note that you are trying to predict what the AI would say, not what you think is correct.`;
    // Reset the radio buttons so they can try again
    document.querySelectorAll(`input[name="practice${questionNum}"]`).forEach(input => {
      input.checked = false;
    });
  }
}

function nextPracticeQuestion(questionNum) {
  document.getElementById(`practice-q${questionNum-1}`).style.display = 'none';
  if (questionNum <= 5) {
    document.getElementById(`practice-q${questionNum}`).style.display = 'block';
  }
}

function finalizePracticeResults() {
  // All questions were answered correctly to get here
  responses.practiceComplete = true;
  responses.timestamps.practiceComplete = new Date().toISOString();
  nextPhase('quiz');
}

// =======================
// QUIZ HANDLERS
// =======================

function checkQuizAnswers() {
  let allCorrect = true;
  
  // Check Quiz 1: Should be "ai"
  if (!document.querySelector('input[name="quiz1"]:checked') || 
      document.querySelector('input[name="quiz1"]:checked').value !== 'ai') {
    allCorrect = false;
  }
  
  // Check Quiz 2: Should be "images"  
  if (!document.querySelector('input[name="quiz2"]:checked') || 
      document.querySelector('input[name="quiz2"]:checked').value !== 'images') {
    allCorrect = false;
  }
  
  // Check Quiz 3: Should be "ai"
  if (!document.querySelector('input[name="quiz3"]:checked') || 
      document.querySelector('input[name="quiz3"]:checked').value !== 'ai') {
    allCorrect = false;
  }
  
  if (allCorrect) {
    document.getElementById('quiz-feedback').innerHTML = 
      '<p class="success">Perfect! You answered all questions correctly.</p>';
    document.getElementById('start-main-experiment').style.display = 'block';
  } else {
    document.getElementById('quiz-feedback').innerHTML = 
      '<p class="error">Please review the instructions and try again. All questions must be answered correctly.</p>';
    // Reset quiz
    document.querySelectorAll('input[name^="quiz"]').forEach(input => input.checked = false);
  }
  
  document.getElementById('quiz-feedback').style.display = 'block';
}

// =======================
// TRAINING SESSION HANDLERS
// =======================

function nextTrainingExample(session, exampleNum) {
  // Hide current, show next
  document.getElementById(`train${session}-ex${exampleNum-1}`).style.display = 'none';
  if (exampleNum <= (session === 1 ? 5 : session === 2 ? 10 : 15)) {
    document.getElementById(`train${session}-ex${exampleNum}`).style.display = 'block';
  }
}

function populateReservoir(session) {
  const reservoir = document.getElementById(`reservoir${session}`).querySelector('.reservoir-content');
  
  // Clear existing content
  reservoir.innerHTML = '';
  
  // Determine number of examples for this session
  let numExamples;
  if (session === 1) numExamples = 5;
  else if (session === 2) numExamples = 10;
  else numExamples = 15;
  
  // Add all training examples for this session
  for (let exampleNum = 0; exampleNum < numExamples; exampleNum++) {
    const imageIndex = (session === 1 ? 0 : session === 2 ? 5 : 15) + exampleNum;
    const prediction = IMAGE_URLS.training.predictions[imageIndex];
    const imageUrl = IMAGE_URLS.training.images[imageIndex];
    
    const reservoirItem = document.createElement('div');
    reservoirItem.style.borderBottom = '1px solid #ddd';
    reservoirItem.style.padding = '10px 0';
    reservoirItem.innerHTML = `
      <div style="margin-bottom: 10px;">
        <div style="font-size: 14px; font-weight: bold;">Training Example ${exampleNum + 1}</div>
        <div style="display: flex; gap: 20px; margin: 10px 0; align-items: flex-start;">
          <div style="text-align: center;">
            <div style="font-size: 12px; margin-bottom: 5px;">Image</div>
            <img src="${imageUrl}" style="width: 120px; height: 90px; object-fit: contain; border: 1px solid #ccc;">
          </div>
          <div style="align-self: center; min-width: 100px;">
            <div style="font-size: 13px; font-weight: bold;">AI Prediction:</div>
            <div style="font-size: 13px;">${prediction}</div>
          </div>
        </div>
      </div>
    `;
    
    reservoir.appendChild(reservoirItem);
  }
}

function clearReservoir(session) {
  const reservoir = document.getElementById(`reservoir${session}`).querySelector('.reservoir-content');
  reservoir.innerHTML = '<em>Training examples will appear here during testing</em>';
}

function startTest(session) {
  // Populate the reservoir with all training examples when starting the test
  populateReservoir(session);
  
  document.getElementById(`training${session}-examples`).style.display = 'none';
  document.getElementById(`test${session}`).style.display = 'block';
}

function nextTestQuestion(session, questionNum) {
  document.getElementById(`test${session}-q${questionNum-1}`).style.display = 'none';
  document.getElementById(`test${session}-q${questionNum}`).style.display = 'block';
}

// =======================
// PHASE MANAGEMENT
// =======================

function nextPhase(phase) {
  // Hide all phases
  document.querySelectorAll('.phase').forEach(p => p.style.display = 'none');
  // Show target phase
  document.getElementById(phase).style.display = 'block';
  
  // Clear reservoir when starting new training sessions
  if (phase === 'training1') {
    clearReservoir(1);
  } else if (phase === 'training2') {
    clearReservoir(2);
  } else if (phase === 'training3') {
    clearReservoir(3);
  }
  
  // Record timestamp
  responses.timestamps[phase] = new Date().toISOString();
}
// =======================
// EVENT LISTENERS
// =======================



// Add event listeners for radio buttons to show next buttons
document.addEventListener('change', function(e) {
  if (e.target.type === 'radio') {
    const name = e.target.name;

    // Show continue button for consent
    if (name === 'consent') {
      document.getElementById('consent-submit').style.display = 'block';
    }

    // Show check button for practice questions
    if (name.startsWith('practice')) {
      const questionNum = name.replace('practice', '');
      const checkBtn = document.getElementById(`practice-check-${questionNum}`);
      if (checkBtn) checkBtn.style.display = 'block';
    }
    
    // Show next button for test questions
    if (name.startsWith('test')) {
      const parts = name.split('_');
      const session = parts[0].replace('test', '');
      const questionNum = parts[1].replace('q', '');
      const nextBtn = document.getElementById(`test${session}-next-${questionNum}`);
      if (nextBtn) nextBtn.style.display = 'block';
    }
    
    // Store response
    responses[name] = e.target.value;
    
    // Update AMT form progressively
    updateAMTForm();
  }
});

// =======================
// FORM MANAGEMENT
// =======================

function updateAMTForm() {
  document.getElementById('all-responses').value = JSON.stringify(responses);
}

function completeStudy() {
  responses.timestamps.completion = new Date().toISOString();
  responses.totalTime = new Date() - startTime;
  
  // 2. Fill hidden fields (optional, but keeps everything consistent)
  document.getElementById("all-responses").value = JSON.stringify(responses);
  document.getElementById("completion-time").value = responses.timestamps.completion;
  document.getElementById("prolific-id-hidden").value = responses.prolific_id;

  // 3. Send to Google Form (replace YOUR IDs!)
  fetch("https://docs.google.com/forms/d/e/1FAIpQLSeTKDjemztrI3GMLAZLPNIB9y__AKAhdr6WEKTwiZfi6C420A/formResponse", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({
      "entry.168008292": document.getElementById("all-responses").value,   // all_responses
      "entry.1441252151": document.getElementById("completion-time").value, // completion_time
      "entry.1047525154": responses.prolific_id // prolific_id (replace xxxxxx with actual field ID)
    })
  }).finally(() => {
    // 4. Delay redirect slightly so the fetch has time to flush
    setTimeout(() => {
      window.location.href = "https://app.prolific.com/submissions/complete?cc=C17WH9PO";
    }, 500); // ~0.5s is usually enough
  });
}

// =======================
// INITIALIZATION
// =======================

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
  responses.timestamps.start = new Date().toISOString();
  responses.prolific_id = getProlificId();
  responses.timestamps.prolific_id = new Date().toISOString();
  loadAllImages();
  // Start with consent form (it's already visible by default)
  console.log('Experiment initialized - starting with consent form');
  console.log('Prolific ID captured:', responses.prolific_id);
});
</script>